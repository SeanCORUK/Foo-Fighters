{% assign block_settings = block.settings %}
<div
  class="email-signup-block size-style spacing-style"
  style="{% render 'size-style', settings: block_settings %}{% render 'spacing-style', settings: block_settings %}"
  {{ block.shopify_attributes }}
>
  {% if block_settings.heading != blank %}
    <div class="email-signup__heading {{ block_settings.heading_preset }}">
      {{ block_settings.heading | escape }}
    </div>
  {% endif %}

  {% if block.settings.ae_segment_id == blank 
     or block.settings.ae_brand_id == blank 
     or block.settings.ae_activities == blank 
     or block.settings.ae == blank 
     or block.settings.mailing_list_id == blank %}

    <p class="error" style="text-align:center; font-weight: bold; color: var(--color-error)">
      Sony form settings not complete
    </p>
  {% else %}
    <form id="{{ block.id }}-form" class="sign-up-form">
        <input type="hidden" name="js_url" id="js_url" value="https://subs.sonymusicfans.com/submit">
        <input type="hidden" name="ae_segment_id" id="ae_segment_id" value="{{ block.settings.ae_segment_id }}">
        <input type="hidden" name="ae_brand_id" id="ae_brand_id" value="{{ block.settings.ae_brand_id }}">
        <input
        type="hidden"
        name="ae_activities"
        id="ae_activities"
        value="{{ block.settings.ae_activities }}"
        >
        <input type="hidden" name="ae" id="ae" value="{{ block.settings.ae }}">
        <input type="hidden" name="form" value="{{ block.settings.form }}">
        <input type="hidden" name="mailing-list-id[0]" value="{{ block.settings.mailing_list_id }}">
        {% if block.settings.triggered_sends != blank %}
        <input type="hidden" name="triggered_sends[0]" value="{{ block.settings.triggered_sends }}">
        {% endif %}

        <div class="email-signup__twocol">

            <div
            class="email-signup__input-group {% if block_settings.border_style == 'none' %}email-signup__input-group--no-border{% endif %} {% if block_settings.inherit_color_scheme == false %}color-{{ block_settings.color_scheme }}{% endif %}"
            style="--border-width: {{ block_settings.border_width }}px; --border-radius: {{ block_settings.border_radius }}px;"
            >
            <label for="field_first_name" class="form-label visually-hidden">First Name</label>
            <input
            class="email-signup__input sign-up--input"
            id="field_first_name"
            name="field_first_name"
            type="text"
            placeholder="first name"
            >
            </div>


            <div
            class="email-signup__input-group {% if block_settings.border_style == 'none' %}email-signup__input-group--no-border{% endif %} {% if block_settings.inherit_color_scheme == false %}color-{{ block_settings.color_scheme }}{% endif %} country-select-wrapper"
            style="--border-width: {{ block_settings.border_width }}px; --border-radius: {{ block_settings.border_radius }}px;"
            >
              <label
                for="field_country_region"
                class="visually-hidden"
              >
                Country
              </label>
              <select
                required=""
                aria-label="Your country"
                name="field_country_region"
                class="email-signup__input country-select"
              >
                <option disabled="" value="">Select Country</option>
                <option value="GB" selected>United Kingdom</option>
                <option value="AF">Afghanistan</option>
                <option value="AX">Åland Islands</option>
                <option value="AL">Albania</option>
                <option value="DZ">Algeria</option>
                <option value="AS">American Samoa</option>
                <option value="AD">Andorra</option>
                <option value="AO">Angola</option>
                <option value="AI">Anguilla</option>
                <option value="AQ">Antarctica</option>
                <option value="AG">Antigua &amp; Barbuda</option>
                <option value="AR">Argentina</option>
                <option value="AM">Armenia</option>
                <option value="AW">Aruba</option>
                <option value="AU">Australia</option>
                <option value="AT">Austria</option>
                <option value="AZ">Azerbaijan</option>
                <option value="BS">Bahamas</option>
                <option value="BH">Bahrain</option>
                <option value="BD">Bangladesh</option>
                <option value="BB">Barbados</option>
                <option value="BY">Belarus</option>
                <option value="BE">Belgium</option>
                <option value="BZ">Belize</option>
                <option value="BJ">Benin</option>
                <option value="BM">Bermuda</option>
                <option value="BT">Bhutan</option>
                <option value="BO">Bolivia</option>
                <option value="BA">Bosnia</option>
                <option value="BW">Botswana</option>
                <option value="BV">Bouvet Island</option>
                <option value="BR">Brazil</option>
                <option value="IO">British Indian Ocean Territory</option>
                <option value="VG">British Virgin Islands</option>
                <option value="BN">Brunei</option>
                <option value="BG">Bulgaria</option>
                <option value="BF">Burkina Faso</option>
                <option value="BI">Burundi</option>
                <option value="KH">Cambodia</option>
                <option value="CM">Cameroon</option>
                <option value="CA">Canada</option>
                <option value="CV">Cape Verde</option>
                <option value="BQ">Caribbean Netherlands</option>
                <option value="KY">Cayman Islands</option>
                <option value="CF">Central African Republic</option>
                <option value="TD">Chad</option>
                <option value="CL">Chile</option>
                <option value="CN">China</option>
                <option value="CX">Christmas Island</option>
                <option value="CC">Cocos (Keeling) Islands</option>
                <option value="CO">Colombia</option>
                <option value="KM">Comoros</option>
                <option value="CG">Congo - Brazzaville</option>
                <option value="CD">Congo - Kinshasa</option>
                <option value="CK">Cook Islands</option>
                <option value="CR">Costa Rica</option>
                <option value="CI">Côte d’Ivoire</option>
                <option value="HR">Croatia</option>
                <option value="CU">Cuba</option>
                <option value="CW">Curaçao</option>
                <option value="CY">Cyprus</option>
                <option value="CZ">Czechia</option>
                <option value="DK">Denmark</option>
                <option value="DJ">Djibouti</option>
                <option value="DM">Dominica</option>
                <option value="DO">Dominican Republic</option>
                <option value="EC">Ecuador</option>
                <option value="EG">Egypt</option>
                <option value="SV">El Salvador</option>
                <option value="GQ">Equatorial Guinea</option>
                <option value="ER">Eritrea</option>
                <option value="EE">Estonia</option>
                <option value="SZ">Eswatini</option>
                <option value="ET">Ethiopia</option>
                <option value="FK">Falkland Islands</option>
                <option value="FO">Faroe Islands</option>
                <option value="FJ">Fiji</option>
                <option value="FI">Finland</option>
                <option value="FR">France</option>
                <option value="GF">French Guiana</option>
                <option value="PF">French Polynesia</option>
                <option value="TF">French Southern Territories</option>
                <option value="GA">Gabon</option>
                <option value="GM">Gambia</option>
                <option value="GE">Georgia</option>
                <option value="DE">Germany</option>
                <option value="GH">Ghana</option>
                <option value="GI">Gibraltar</option>
                <option value="GR">Greece</option>
                <option value="GL">Greenland</option>
                <option value="GD">Grenada</option>
                <option value="GP">Guadeloupe</option>
                <option value="GU">Guam</option>
                <option value="GT">Guatemala</option>
                <option value="GG">Guernsey</option>
                <option value="GN">Guinea</option>
                <option value="GW">Guinea-Bissau</option>
                <option value="GY">Guyana</option>
                <option value="HT">Haiti</option>
                <option value="HM">Heard &amp; McDonald Islands</option>
                <option value="HN">Honduras</option>
                <option value="HK">Hong Kong</option>
                <option value="HU">Hungary</option>
                <option value="IS">Iceland</option>
                <option value="IN">India</option>
                <option value="ID">Indonesia</option>
                <option value="IR">Iran</option>
                <option value="IQ">Iraq</option>
                <option value="IE">Ireland</option>
                <option value="IM">Isle of Man</option>
                <option value="IL">Israel</option>
                <option value="IT">Italy</option>
                <option value="JM">Jamaica</option>
                <option value="JP">Japan</option>
                <option value="JE">Jersey</option>
                <option value="JO">Jordan</option>
                <option value="KZ">Kazakhstan</option>
                <option value="KE">Kenya</option>
                <option value="KI">Kiribati</option>
                <option value="KW">Kuwait</option>
                <option value="KG">Kyrgyzstan</option>
                <option value="LA">Laos</option>
                <option value="LV">Latvia</option>
                <option value="LB">Lebanon</option>
                <option value="LS">Lesotho</option>
                <option value="LR">Liberia</option>
                <option value="LY">Libya</option>
                <option value="LI">Liechtenstein</option>
                <option value="LT">Lithuania</option>
                <option value="LU">Luxembourg</option>
                <option value="MO">Macau</option>
                <option value="MG">Madagascar</option>
                <option value="MW">Malawi</option>
                <option value="MY">Malaysia</option>
                <option value="MV">Maldives</option>
                <option value="ML">Mali</option>
                <option value="MT">Malta</option>
                <option value="MH">Marshall Islands</option>
                <option value="MQ">Martinique</option>
                <option value="MR">Mauritania</option>
                <option value="MU">Mauritius</option>
                <option value="YT">Mayotte</option>
                <option value="MX">Mexico</option>
                <option value="FM">Micronesia</option>
                <option value="MD">Moldova</option>
                <option value="MC">Monaco</option>
                <option value="MN">Mongolia</option>
                <option value="ME">Montenegro</option>
                <option value="MS">Montserrat</option>
                <option value="MA">Morocco</option>
                <option value="MZ">Mozambique</option>
                <option value="MM">Myanmar</option>
                <option value="NA">Namibia</option>
                <option value="NR">Nauru</option>
                <option value="NP">Nepal</option>
                <option value="NL">Netherlands</option>
                <option value="NC">New Caledonia</option>
                <option value="NZ">New Zealand</option>
                <option value="NI">Nicaragua</option>
                <option value="NE">Niger</option>
                <option value="NG">Nigeria</option>
                <option value="NU">Niue</option>
                <option value="NF">Norfolk Island</option>
                <option value="KP">North Korea</option>
                <option value="MK">North Macedonia</option>
                <option value="MP">Northern Mariana Islands</option>
                <option value="NO">Norway</option>
                <option value="OM">Oman</option>
                <option value="PK">Pakistan</option>
                <option value="PW">Palau</option>
                <option value="PS">Palestine</option>
                <option value="PA">Panama</option>
                <option value="PG">Papua New Guinea</option>
                <option value="PY">Paraguay</option>
                <option value="PE">Peru</option>
                <option value="PH">Philippines</option>
                <option value="PN">Pitcairn Islands</option>
                <option value="PL">Poland</option>
                <option value="PT">Portugal</option>
                <option value="PR">Puerto Rico</option>
                <option value="QA">Qatar</option>
                <option value="RE">Réunion</option>
                <option value="RO">Romania</option>
                <option value="RU">Russia</option>
                <option value="RW">Rwanda</option>
                <option value="WS">Samoa</option>
                <option value="SM">San Marino</option>
                <option value="ST">São Tomé &amp; Príncipe</option>
                <option value="SA">Saudi Arabia</option>
                <option value="SN">Senegal</option>
                <option value="RS">Serbia</option>
                <option value="SC">Seychelles</option>
                <option value="SL">Sierra Leone</option>
                <option value="SG">Singapore</option>
                <option value="SX">Sint Maarten</option>
                <option value="SK">Slovakia</option>
                <option value="SI">Slovenia</option>
                <option value="SB">Solomon Islands</option>
                <option value="SO">Somalia</option>
                <option value="ZA">South Africa</option>
                <option value="GS">South Georgia &amp; South Sandwich Islands</option>
                <option value="KR">South Korea</option>
                <option value="SS">South Sudan</option>
                <option value="ES">Spain</option>
                <option value="LK">Sri Lanka</option>
                <option value="BL">St. Barthélemy</option>
                <option value="SH">St. Helena</option>
                <option value="KN">St. Kitts &amp; Nevis</option>
                <option value="LC">St. Lucia</option>
                <option value="MF">St. Martin</option>
                <option value="PM">St. Pierre &amp; Miquelon</option>
                <option value="VC">St. Vincent &amp; Grenadines</option>
                <option value="SD">Sudan</option>
                <option value="SR">Suriname</option>
                <option value="SJ">Svalbard &amp; Jan Mayen</option>
                <option value="SE">Sweden</option>
                <option value="CH">Switzerland</option>
                <option value="SY">Syria</option>
                <option value="TW">Taiwan</option>
                <option value="TJ">Tajikistan</option>
                <option value="TZ">Tanzania</option>
                <option value="TH">Thailand</option>
                <option value="TL">Timor-Leste</option>
                <option value="TG">Togo</option>
                <option value="TK">Tokelau</option>
                <option value="TO">Tonga</option>
                <option value="TT">Trinidad &amp; Tobago</option>
                <option value="TN">Tunisia</option>
                <option value="TR">Turkey</option>
                <option value="TM">Turkmenistan</option>
                <option value="TC">Turks &amp; Caicos Islands</option>
                <option value="TV">Tuvalu</option>
                <option value="UM">U.S. Outlying Islands</option>
                <option value="VI">U.S. Virgin Islands</option>
                <option value="UG">Uganda</option>
                <option value="UA">Ukraine</option>
                <option value="AE">United Arab Emirates</option>
                <option value="UY">Uruguay</option>
                <option value="US">United States of America</option>
                <option value="UZ">Uzbekistan</option>
                <option value="VU">Vanuatu</option>
                <option value="VA">Vatican City</option>
                <option value="VE">Venezuela</option>
                <option value="VN">Vietnam</option>
                <option value="WF">Wallis &amp; Futuna</option>
                <option value="EH">Western Sahara</option>
                <option value="YE">Yemen</option>
                <option value="ZM">Zambia</option>
                <option value="ZW">Zimbabwe</option>
              </select>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" aria-hidden="true">
                <path d="M144.69 15.56c8.47-8.47 22.22-8.47 30.69 0l130.06 130.06c8.47 8.47 8.47 22.22 0 30.69-8.47 8.47-22.22 8.47-30.69 0L160 61.56 45.25 176.24c-8.47 8.47-22.22 8.47-30.69 0s-8.47-22.22 0-30.69L144.62 15.49l.07.07ZM175.31 498.78c-8.47 8.47-22.22 8.47-30.69 0L14.57 368.72c-8.47-8.47-8.47-22.22 0-30.69 8.47-8.47 22.22-8.47 30.69 0l114.75 114.75L274.76 338.1c8.47-8.47 22.22-8.47 30.69 0 8.47 8.47 8.47 22.22 0 30.69L175.39 498.85l-.07-.07Z"></path>
              </svg>
            </div>
        </div>

        <div
        class="email-signup__input-group {% if block_settings.integrated_button and block_settings.border_style != 'underline' %}email-signup__input-group--integrated{% endif %} {% if block_settings.border_style == 'underline' %}email-signup__input-group--underline{% endif %} {% if block_settings.border_style == 'none' %}email-signup__input-group--no-border{% endif %} {% if block_settings.display_type == 'arrow' %}email-signup__input-group--arrow{% endif %} {% if block_settings.inherit_color_scheme == false %}color-{{ block_settings.color_scheme }}{% endif %}"
        style="--border-width: {{ block_settings.border_width }}px; --border-radius: {{ block_settings.border_radius }}px;"
        >
        <label
            for="field_email_address"
            class="visually-hidden"
        >
            {{ 'blocks.email_signup.label' | t }}
        </label>
        <input
            id="field_email_address"
            class="email-signup__input email-signup__input--{{ block_settings.border_style }} {{ block_settings.input_type_preset }} {{ block_settings.border_variation }}"
            type="email"
            name="field_email_address"
            autocorrect="off"
            autocapitalize="off"
            autocomplete="email"
            placeholder="{{ 'blocks.email_signup.placeholder' | t }}"
            required
            {% if form.errors %}
            autofocus
            aria-invalid="true"
            aria-describedby="Email-signup__message-error-{{ block.id }}"
            {% elsif form.posted_successfully? %}
            aria-describedby="Email-signup__message-success-{{ block.id }}"
            {% endif %}
        >
        <button
            class="email-signup__button {% if block_settings.integrated_button or block_settings.border_style == 'underline' %}email-signup__button--integrated{% endif %} email-signup__button--{{ block_settings.display_type }} {{ block_settings.button_type_preset }} {{ block_settings.style_class }} {{ block_settings.style_class }}--{{ block.id }} {% if block_settings.inherit_color_scheme == false %}color-{{ block_settings.color_scheme }}{% endif %}"
            {% if block_settings.display_type != 'text' %}
            aria-label="{{ 'actions.sign_up' | t }}"
            {% endif %}
            type="submit"
            id="sme_button"
        >
            {% if block_settings.display_type == 'text' %}
          <span>
            {% assign button_label = block.settings.button_label %}
            {% case button_label %}
              {% when 'sign_up' -%}
                Sign Up
              {% when 'sign_up_now' -%}
                Sign up now
              {% when 'sign_up_now_ex' -%}
                Sign up now!
              {% when 'sign_me_up' -%}
                Sign me up
              {% when 'sign_me_up_ex' -%}
                Sign me up!
              {% when 'subscribe' -%}
                Subscribe
              {% when 'subscribe_now' -%}
                Subscribe now
              {% when 'subscribe_now_ex' -%}
                Subscribe now!
              {% when 'join' -%}
                Join
              {% when 'join_now' -%}
                Join now
              {% when 'join_now_ex' -%}
                Join now!
              {% when 'join_the_mailing_list' -%}
                Join the mailing list
              {% when 'get_the_newsletter' -%}
                Get the newsletter
              {% when 'get_updates' -%}
                Get updates
              {% when 'get_email_updates' -%}
                Get email updates
              {% when 'email_me' -%}
                Email me
              {% when 'submit' -%}
                Submit
              {% when 'custom' %}
                {{ block.settings.button_label_custom }}
            {% endcase %}
          </span>
            {% else %}
            <svg
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
                focusable="false"
                aria-hidden="true"
                class="email-signup__button-icon"
            >
                {% render 'icon', icon: 'arrow' %}
            </svg>
            {% endif %}
        </button>
        </div>

        {%- if form.errors -%}
        <div
            id="Email-signup__message-error-{{ block.id }}"
            class="email-signup__message email-signup__message--error"
            tabindex="-1"
        >
            <svg
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
            focusable="false"
            aria-hidden="true"
            class="icon-error"
            >
            {%- render 'icon', icon: 'error'  -%}
            </svg>
            {{- form.errors.translated_fields.email | capitalize }}
            {{ form.errors.messages.email -}}
        </div>
        {%- endif -%}

        {%- if form.posted_successfully? -%}
        <div
            id="Email-signup__message-success-{{ block.id }}"
            class="email-signup__message email-signup__message--success"
            tabindex="-1"
        >
            <span class="svg-wrapper icon-success">
            {{ 'icon-checkmark.svg' | inline_asset_content }}
            </span>
            <p class="email-signup__message-text">{{ 'blocks.email_signup.success' | t }}</p>
        </div>
        {%- endif -%}
    </form>

      <p class="small text-center text-balance">
        By signing up I agree to the
        <a
          href="{% if block.settings.custom_privacy != blank %}{{ block.settings.custom_privacy }}{% else %}https://www.sonymusic.co.uk/privacy{% endif %}"
          target="_blank"
          >privacy policy</a
        >
        and the processing of my data in accordance with it.
      </p>
    {% endif %}
</div>
<script>
  /**
   * Init Campaigns
   */
  const DELAY = 2000;

  jQuery.fn.bsTogglePopover = function () {
    this.popover('show');

    setTimeout(() => {
      this.popover('hide');
    }, DELAY);
  };

  function docReady() {
    let requiredFieldsWrap;
    $('#{{ block.id }}-form').on('click', 'form button[type="submit"]', (event) => {
      event.preventDefault();
      let pass = true;

      $('.default_terms_checkbox').each(function () {
        $(this)
          .parents('.default-terms-wrap')
          .each(function (index, value) {
            $(value).popover({
              placement: 'bottom',
              trigger: 'manual',
              content: $(this).data('validation'),
            });
          });
        const isChecked = $(this).prop('checked');
        if (!isChecked) {
          $(this).parents('.default-terms-wrap').bsTogglePopover();
          pass = false;
        }
      });
      $('#field_search_postal_code, #field_search_address').each(function () {
        $(this)
          .parents('.col')
          .parents('.form-group')
          .each(function (index, value) {
            const validationText = $(this).data('validation')
              ? $(this).data('validation')
              : 'Select from results in dropdown';
            $(value).popover({
              placement: 'right',
              trigger: 'manual',
              content: validationText,
            });
          });
        const isValid = document.querySelector('#field_search_field_validation_hidden').value === 'true';
        const stringValue = $(this).val().trim();
        if (!isValid && stringValue !== '') {
          $(this).parents('.col').parents('.form-group').bsTogglePopover();
          pass = false;
        }
      });

      // Apple Form loads ajax - re-bind validation
      requiredFieldsWrap = $(
        `.form-group[data-validation],
        .ml-wrap[data-validation],
        .presave-terms[data-validation],
        .retargeting-wrapper[data-validation]`
      );

      requiredFieldsWrap.each(function (i, v) {
        const validation = $(this).data('validation');
        $(v).popover({
          placement: 'right',
          trigger: 'manual',
          content: validation,
        });

        if (!isFieldValid(v)) {
          pass = false;
          $(v).bsTogglePopover();
        }
      });

      if (pass) {
        $('#{{ block.id }}-form').submit();
      }
    });
  }

  /**
   * Field validation
   *
   * @param {object} el
   * @return {boolean}
   */
  function isFieldValid(el) {
    const name = $(el).data('name');
    const reEmail =
      /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;

    let value;
    let isValid;
    let fieldObj;
    let instance;
    let rule = $(el).data('validation-rule');
    rule = typeof rule !== 'undefined' ? rule : $(el).data('type');

    switch (rule) {
      case 'text':
        value = $(`input[name='${name}']`).val();
        isValid = value.length !== 0;
        break;

      case 'email':
        value = $(`input[name='${name}']`).val();
        isValid = reEmail.test(value);
        break;

      case 'radio':
        fieldObj = $(`input[name='${name}']`);
        isValid = false;
        fieldObj.each(function () {
          const isChecked = $(this)[0].checked;
          if (isChecked) {
            isValid = true;
          }
        });
        break;

      case 'textarea':
        value = $(`textarea[name='${name}']`).val();
        isValid = value.length !== 0;
        break;

      case 'checkbox':
        value = $(`input[name='${name}']:checked`).val();
        isValid = value !== undefined;
        break;

      case 'select':
        value = $(`select[name='${name}']`).val();
        isValid = !!value;
        break;

      case 'datepicker':
        fieldObj = $('#dob_picker');
        fieldObj.addClass('browser-default');
        instance = M.Datepicker.getInstance(fieldObj[0]);
        value = fieldObj.val();
        isValid = typeof instance.date !== 'undefined' || value.length !== 0;
        break;

      case 'terms':
        value = $(`input#${name}`)[0].checked;
        isValid = value;
        break;
    }

    return isValid;
  }

  $(document).ready(docReady);
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('{{ block.id }}-form'); // Match exact ID
    const button = document.getElementById('sme_button');

    if (button && form) {
      // Prevent button from submitting the form by default
      button.setAttribute('type', 'button');

      button.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        const emailField = form.querySelector('#field_email_address');
        const email = emailField?.value?.trim();

        if (!email || !validateEmail(email)) {
          alert('Please enter a valid email address.');
          return;
        }

        const params = new URLSearchParams();
        for (const [key, value] of new FormData(form)) {
          params.append(key, value);
        }

        fetch('https://subs.sonymusicfans.com/submit', {
          method: 'POST',
          body: params.toString(),
          credentials: 'omit',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
        })
          .then((response) => {
            if (response.ok) {
              const node = document.createElement('p');
              node.classList.add('subscribe-success');
              node.textContent = 'Thank you for signing up';
              form.appendChild(node);
              form.reset(); // optional: clears form
            }
            return response.json(); // for analytics/debug
          })
          .catch((error) => {
            console.error('Sign-up error:', error);
          });
      });
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(String(email).toLowerCase());
    }
  });
</script>

{% stylesheet %}
  .email-signup-block {
    --arrow-button-size: 58px;
    --arrow-button-size-integrated: 42px;
    --arrow-button-size-small: 20px;
    --arrow-icon-size: 32px;
    --arrow-icon-size-small: 24px;

    min-width: fit-content;

    @media screen and (max-width: 749px) {
      width: 100%;
      min-width: unset;
    }
  }

  .email-signup__heading {
    padding-block: var(--padding-sm);
  }

  .email-signup__form {
    display: flex;
    flex-direction: column;
  }

  .email-signup__input-group {
    display: flex;
    align-items: stretch;
    background-color: transparent;
  }

  .email-signup__input-group:not(.email-signup__input-group--integrated):not(.email-signup__input-group--underline) {
    gap: var(--gap-xs);
    align-items: center;
  }

  .email-signup__input-group:not(.email-signup__input-group--arrow):not(.email-signup__input-group--underline):not(
      .email-signup__input-group--integrated
    ) {
    @media screen and (max-width: 749px) {
      flex-direction: column;
    }
  }

  .email-signup__input-group--integrated {
    border-width: var(--border-width);
    border-radius: var(--border-radius);
    border-style: solid;
    border-color: var(--color-input-border);
    background-color: var(--color-input-background);
  }

  .email-signup__input-group--integrated.email-signup__input-group--no-border {
    border: none;
  }

  .email-signup__input {
    flex: 1;
    min-width: 0;
    border-width: var(--border-width);
    border-radius: var(--border-radius);
    border-style: solid;
    border-color: var(--color-input-border);

    @media screen and (max-width: 749px) {
      width: 100%;
    }
  }

  .email-signup__input-group--integrated .email-signup__input {
    background-color: transparent;
    border: none;
    border-radius: 0;
  }

  .email-signup__input.paragraph {
    color: var(--color-input-text);
    outline-color: var(--color-input-background);
  }

  .email-signup__button {
    color: inherit;
    white-space: nowrap;
    padding: 0;
    border-radius: var(--border-radius);

    @media screen and (max-width: 749px) {
      width: 100%;
    }
  }
  .email-signup__button * {
        color: var(--button-color);
  }

  .email-signup__input,
  .email-signup__button--text {
    padding: var(--padding-lg) var(--padding-3xl);
  }

  .email-signup__input-group--underline {
    --box-shadow-color: var(--color-input-border);
    --box-shadow-multiplier: 1;
    --box-shadow-focused-multiplier: 1.75;

    box-shadow: 0 calc(var(--border-width) * var(--box-shadow-multiplier)) 0 var(--box-shadow-color);
    transition: box-shadow var(--animation-values);
    margin-block-end: calc(var(--border-width) * var(--box-shadow-focused-multiplier));

    &:focus-within {
      --box-shadow-multiplier: var(--box-shadow-focused-multiplier);
      --box-shadow-color: var(--color-input-text);
    }
  }

  .email-signup__input-group .email-signup__input--underline {
    color: var(--color-input-text);
    background-color: transparent;
    padding: 12px 0;
    border: none;
    border-radius: 0;

    &:focus-visible {
      outline: none;
    }
  }

  .email-signup__input::placeholder {
    color: rgb(var(--color-input-text-rgb) / var(--opacity-70));
  }

  .email-signup__input-group .email-signup__input--none {
    color: var(--color-input-text);
    background-color: var(--color-input-background);
    border: none;
  }

  .email-signup__button-icon {
    color: currentcolor;
    padding: 5px;

    @media screen and (max-width: 749px) {
      padding: 0;
      align-self: center;
      justify-self: center;
      width: var(--icon-size-lg);
      height: var(--icon-size-lg);
    }
  }

  .email-signup__button--arrow {
    width: var(--arrow-button-size-small);
    height: var(--arrow-button-size-small);
    padding: 0;

    &:not(.email-signup__button--integrated) {
      width: var(--arrow-button-size);
      height: var(--arrow-button-size);
      display: flex;
      align-items: center;
      justify-content: center;

      > .email-signup__button-icon {
        width: var(--arrow-icon-size);
        height: var(--arrow-icon-size);
        padding: 0;
      }
    }
  }

  .email-signup__button--integrated {
    --button-offset: var(--margin-xs);
    align-self: stretch;
    margin: var(--button-offset);
    flex-shrink: 0;

    @media screen and (max-width: 749px) {
      width: fit-content;
    }

    &.email-signup__button--text {
      padding: 0 var(--padding-3xl);
    }

    &.email-signup__button--text.button-unstyled {
      padding: 0 var(--padding-xl);
    }

    &.button-unstyled {
      border-radius: var(--border-radius);
    }

    > .email-signup__button-icon {
      padding: 0;
    }

    &.email-signup__button--arrow {
      width: var(--arrow-button-size-integrated);
      height: var(--arrow-button-size-integrated);
      align-self: center;
      display: flex;
      align-items: center;
      justify-content: center;

      > .email-signup__button-icon {
        width: var(--arrow-icon-size-small);
        height: var(--arrow-icon-size-small);
      }
    }
  }

  .email-signup__input--underline + .email-signup__button--integrated {
    margin: 0;
    align-self: center;

    &.email-signup__button--text {
      padding-block: 9px;
    }

    &.email-signup__button--text.button-unstyled {
      padding-inline: 0;
    }

    &.button-unstyled {
      border-radius: 0;
    }

    &.email-signup__button--arrow {
      width: var(--arrow-button-size-integrated);
      height: var(--arrow-button-size-integrated);
      display: flex;
      align-items: center;
      justify-content: center;

      > .email-signup__button-icon {
        width: var(--arrow-icon-size-small);
        height: var(--arrow-icon-size-small);
      }
    }
  }

  .email-signup__button:not(.button-unstyled) {
    background-color: var(--button-background-color);
    color: var(--button-color);
    text-transform: var(--button-text-case-primary);
  }

  .email-signup__button.button-secondary {
    text-transform: var(--button-text-case-secondary);
  }

  .email-signup__button.button-unstyled {
    background-color: transparent;
    color: var(--color-input-text);
  }

  .email-signup__button.button-unstyled:hover {
    color: rgb(var(--color-input-text-rgb) / var(--opacity-70));
    cursor: pointer;
  }

  .email-signup__message {
    display: flex;
    align-items: center;
    gap: var(--gap-xs);
  }

  .email-signup__message-text {
    margin: 0;
  }

  /* COR edit */
  .sign-up-form {
    display: grid;
    gap: var(--gap-md);
  }
  .email-signup__twocol {
    display: grid;
    gap: var(--gap-md);
    @media (min-width: 750px) {
        grid-template-columns: 1fr 1fr;
    }   
  }
  .country-select-wrapper select {
    appearance: none;
  }
  .country-select-wrapper {
    position: relative;
  }
  .country-select-wrapper svg {
    pointer-events: none;
    width: 23px;
    height: 23px;
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
  }

  .subscribe-success {
    margin: 0;
    position: absolute;
    inset: 0;
    display: grid;
    place-content: center;
    background: var(--color-background);
  }
  .email-signup-block .small { font-size: 75%; }
{% endstylesheet %}

{% schema %}
{
  "name": "Email signup | Fansifter",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "The settings below can be obtained from CRM - contact Neato & Georgina Dagly who will need to generate an audience to track sign ups via the form."
    },
    {
      "type": "text",
      "id": "ae_segment_id",
      "label": "Segment ID",
      "info": "eg: 2217891"
    },
    {
      "type": "text",
      "id": "ae_brand_id",
      "label": "Brand ID",
      "info": "eg: 5132382"
    },
    {
      "type": "liquid",
      "id": "ae_activities",
      "label": "Activities",
      "info": "eg: {\"actions\":{\"formsubmission\":148903,\"secondaryformsubmission\":0},\"mailing_list_optins\":{\"a0STy000001sTZ7MAM\":148906}}"
    },
    {
      "type": "text",
      "id": "ae",
      "label": "ae",
      "info": "eg: e09e362622ec5d3a102a75cf1169a42738452a6dd5df3f08b02d874b7c0cbc56"
    },
    {
      "type": "text",
      "id": "form",
      "label": "Form",
      "info": "eg: 475859"
    },
    {
      "type": "text",
      "id": "mailing_list_id",
      "label": "Mailing List ID",
      "info": "eg: a0STy000001sTZ7MAM"
    },
    {
      "type": "text",
      "id": "triggered_sends",
      "label": "Trigger welcome email",
      "info": "Optional, eg: 6396081;TE_On_Repeat_WelcomeEmail_NEW;a0STy000001sTZ7MAM"
    },
    {
      "type": "url",
      "id": "custom_privacy",
      "label": "Privacy Policy",
      "info": "Only use if not using SME privacy policy."
    },
    {
      "type": "paragraph",
      "content": "t:content.email_signups_create_customer_profiles"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:settings.width",
      "options": [
        {
          "value": "fill",
          "label": "t:options.fill"
        },
        {
          "value": "custom",
          "label": "t:options.custom"
        }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_width",
      "label": "t:settings.custom_width",
      "min": 20,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 100,
      "visible_if": "{{ block.settings.width == \"custom\" }}"
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "t:settings.inherit_color_scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "primary",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "header",
      "content": "t:content.heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:settings.text"
    },
    {
      "type": "select",
      "id": "heading_preset",
      "label": "t:settings.type_preset",
      "options": [
        {
          "value": "",
          "label": "t:options.default"
        },
        {
          "value": "paragraph",
          "label": "t:options.paragraph"
        },
        {
          "value": "h1",
          "label": "t:options.h1"
        },
        {
          "value": "h2",
          "label": "t:options.h2"
        },
        {
          "value": "h3",
          "label": "t:options.h3"
        },
        {
          "value": "h4",
          "label": "t:options.h4"
        },
        {
          "value": "h5",
          "label": "t:options.h5"
        },
        {
          "value": "h6",
          "label": "t:options.h6"
        }
      ],
      "default": "h3",
      "info": "t:info.edit_presets_in_theme_settings"
    },
    {
      "type": "header",
      "content": "t:content.input"
    },
    {
      "type": "select",
      "id": "border_style",
      "label": "t:settings.border",
      "options": [
        {
          "value": "all",
          "label": "t:options.all"
        },
        {
          "value": "underline",
          "label": "t:options.underline"
        },
        {
          "value": "none",
          "label": "t:options.none"
        }
      ],
      "default": "all"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "t:settings.border_width",
      "min": 0,
      "max": 4,
      "step": 0.5,
      "unit": "px",
      "default": 1,
      "visible_if": "{{ block.settings.border_style != \"none\" }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 100,
      "visible_if": "{{ block.settings.border_style != \"underline\" }}"
    },
    {
      "type": "select",
      "id": "input_type_preset",
      "label": "t:settings.type_preset",
      "options": [
        {
          "value": "",
          "label": "t:options.default"
        },
        {
          "value": "paragraph",
          "label": "t:options.paragraph"
        },
        {
          "value": "h1",
          "label": "t:options.h1"
        },
        {
          "value": "h2",
          "label": "t:options.h2"
        },
        {
          "value": "h3",
          "label": "t:options.h3"
        },
        {
          "value": "h4",
          "label": "t:options.h4"
        },
        {
          "value": "h5",
          "label": "t:options.h5"
        },
        {
          "value": "h6",
          "label": "t:options.h6"
        }
      ],
      "default": "paragraph",
      "info": "t:info.edit_presets_in_theme_settings"
    },
    {
      "type": "header",
      "content": "t:content.submit_button"
    },
    {
      "type": "select",
      "id": "style_class",
      "label": "t:settings.style",
      "options": [
        {
          "value": "button",
          "label": "t:options.primary"
        },
        {
          "value": "button-secondary",
          "label": "t:options.secondary"
        },
        {
          "value": "button-unstyled",
          "label": "t:options.link"
        }
      ],
      "default": "button"
    },
    {
      "type": "select",
      "id": "display_type",
      "label": "t:settings.display",
      "options": [
        {
          "value": "text",
          "label": "t:options.text"
        },
        {
          "value": "arrow",
          "label": "t:options.arrow"
        }
      ],
      "default": "text"
    },
    {
        "type": "select",
        "id": "button_label",
        "label": "Button Label",
        "visible_if": "{{ block.settings.display_type == \"text\" }}",
        "options": [
            {
                "value": "sign_up",
                "label": "Sign up"
            },
            {
                "value": "sign_up_now",
                "label": "Sign up now"
            },
            {
                "value": "sign_up_now_ex",
                "label": "Sign up now!"
            },
            {
                "value": "sign_me_up",
                "label": "Sign me up"
            },
            {
                "value": "sign_me_up_ex",
                "label": "Sign me up!"
            },
            {
                "value": "subscribe",
                "label": "Subscribe"
            },
            {
                "value": "subscribe_now",
                "label": "Subscribe now"
            },
            {
                "value": "subscribe_now_ex",
                "label": "Subscribe now!"
            },
            {
                "value": "join",
                "label": "Join"
            },
            {
                "value": "join_now",
                "label": "Join now"
            },
            {
                "value": "join_now_ex",
                "label": "Join now!"
            },
            {
                "value": "join_the_mailing_list",
                "label": "Join the mailing list"
            },
            {
                "value": "get_the_newsletter",
                "label": "Get the newsletter"
            },
            {
                "value": "get_updates",
                "label": "Get updates"
            },
            {
                "value": "get_email_updates",
                "label": "Get email updates"
            },
            {
                "value": "email_me",
                "label": "Email me"
            },
            {
                "value": "submit",
                "label": "Submit"
            },
            {
                "value": "custom",
                "label": "Custom"
            }
        ]
    },
    {
        "type": "text",
        "id": "button_label_custom",
        "label": "Custom label",
        "default": "Custom label",
        "visible_if": "{{ block.settings.button_label == 'custom' }}"
    },
    {
      "type": "checkbox",
      "id": "integrated_button",
      "label": "t:settings.integrated_button",
      "default": false,
      "visible_if": "{{ block.settings.border_style != \"underline\" }}"
    },
    {
      "type": "select",
      "id": "button_type_preset",
      "label": "t:settings.type_preset",
      "options": [
        {
          "value": "",
          "label": "t:options.default"
        },
        {
          "value": "paragraph",
          "label": "t:options.paragraph"
        },
        {
          "value": "h1",
          "label": "t:options.h1"
        },
        {
          "value": "h2",
          "label": "t:options.h2"
        },
        {
          "value": "h3",
          "label": "t:options.h3"
        },
        {
          "value": "h4",
          "label": "t:options.h4"
        },
        {
          "value": "h5",
          "label": "t:options.h5"
        },
        {
          "value": "h6",
          "label": "t:options.h6"
        }
      ],
      "default": "paragraph",
      "info": "t:info.edit_presets_in_theme_settings",
      "visible_if": "{{ block.settings.display_type == \"text\" }}"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Email signup | Fansifter",
      "category": "t:categories.forms"
    }
  ]
}
{% endschema %}
